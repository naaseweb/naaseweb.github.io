<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NAASE Membership Form</title>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 40px auto; line-height: 1.5; padding: 0 14px; }
    table { width: 100%; border-collapse: collapse; }
    td { padding: 8px 6px; vertical-align: middle; }
    input[type="text"], input[type="email"] { width: 100%; padding: 8px; box-sizing: border-box; }
    .small { max-width: 120px; }
    button { padding: 10px 16px; font-weight: bold; cursor: pointer; }
    #status { margin-left: 10px; font-weight: bold; }
    .note { font-style: italic; }
  </style>
</head>

<body>
  <h1>NAASE Membership Form</h1>

  <form id="membershipForm" novalidate>
    <p>
      Country code (if outside North America)<br>
      <input class="small" maxlength="4" name="CountryCode" size="4" type="text">
    </p>

    <table border="0">
      <tbody>
        <tr>
          <td width="25%">First Name*</td>
          <td width="50%"><input maxlength="30" name="FirstName" type="text" required></td>
        </tr>
        <tr>
          <td>Last Name*</td>
          <td><input maxlength="30" name="LastName" type="text" required></td>
        </tr>
        <tr>
          <td>Department</td>
          <td><input maxlength="40" name="Department" type="text"></td>
        </tr>
        <tr>
          <td>College or University</td>
          <td><input maxlength="40" name="University" type="text"></td>
        </tr>
        <tr>
          <td colspan="2" align="center" class="note">
            (Your JSE subscription will be sent to this address. You can use a different billing address at PayPal.)
          </td>
        </tr>
        <tr>
          <td>Address*</td>
          <td><input maxlength="40" name="AddrLine" type="text" required></td>
        </tr>
        <tr>
          <td>City*</td>
          <td><input maxlength="40" name="City" type="text" required></td>
        </tr>
        <tr>
          <td>State*</td>
          <td><input class="small" maxlength="2" name="State" type="text" required></td>
        </tr>
        <tr>
          <td>ZIP Code*</td>
          <td><input maxlength="10" name="ZIP" type="text" required></td>
        </tr>
        <tr>
          <td>Phone (10 digits, no dashes)</td>
          <td><input maxlength="10" name="Phone" type="text"></td>
        </tr>
        <tr>
          <td>Email Address*</td>
          <td><input maxlength="256" name="mailfrom" type="email" required></td>
        </tr>
        <tr>
          <td>Student</td>
          <td><input name="Student" type="checkbox" value="Yes"></td>
        </tr>
      </tbody>
    </table>

    <!-- metadata for the email you receive -->
    <input type="hidden" name="_subject" value="New NAASE Membership Submission">
    <input type="text" name="_gotcha" style="display:none">

    <p>
      <!-- type=button prevents the browser from navigating to Formspree -->
      <button id="submitBtn" type="button">Continue to Payment</button>
      <span id="status" aria-live="polite"></span>
    </p>

    <p>
      If you have trouble submitting, you can go directly to payment:
      <a href="/payment/">/payment/</a>
    </p>
  </form>

  <script>
    (function () {
      const FORMSPREE = "https://formspree.io/f/meeleqrr";
      const form = document.getElementById("membershipForm");
      const btn = document.getElementById("submitBtn");
      const status = document.getElementById("status");

      function validateRequired() {
        // basic required field check (works everywhere)
        const required = form.querySelectorAll("[required]");
        for (const el of required) {
          if (!el.value || !el.value.trim()) {
            el.focus();
            return false;
          }
        }
        // minimal email check
        const email = form.querySelector('input[name="mailfrom"]');
        if (email && !/^\S+@\S+\.\S+$/.test(email.value.trim())) {
          email.focus();
          return false;
        }
        return true;
      }

      btn.addEventListener("click", async function () {
        if (!validateRequired()) {
          status.textContent = "Please complete required fields.";
          return;
        }

        status.textContent = "Submittingâ€¦";
        btn.disabled = true;

        try {
          const data = new FormData(form);
          const resp = await fetch(FORMSPREE, {
            method: "POST",
            body: data,
            headers: { "Accept": "application/json" }
          });
          if (!resp.ok) throw new Error("Formspree submission failed");

          // This redirect is relative and will work on BOTH domains
          window.location.assign("/payment/");
        } catch (e) {
          status.textContent = "Submit failed. Please try again or use the payment link.";
          btn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
